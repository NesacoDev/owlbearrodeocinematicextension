import{t as e}from"./lib-CEItrqmJ.js";console.log(`[DEBUG] modal.js carregado`);var t=document.getElementById(`video`),n=document.getElementById(`soundBtn`),r=document.getElementById(`status`),i=document.getElementById(`playOverlay`);console.log(`[DEBUG] video:`,t),console.log(`[DEBUG] soundBtn:`,n),console.log(`[DEBUG] status:`,r),console.log(`[DEBUG] playOverlay:`,i);var a=document.getElementById(`gmControls`),o=document.getElementById(`btnPauseResume`),s=document.getElementById(`btnSync`),c=document.getElementById(`btnCloseAll`),l=`com.saimon.video-sync`,u=`video-player-modal`;console.log(`[DEBUG] BROADCAST_CHANNEL:`,l),console.log(`[DEBUG] MODAL_ID:`,u);var d=null,f=async(n,r={})=>{if(n===`sync-pause`){console.log(`â¸ï¸ Pausando via sync`),t.pause(),typeof r.currentTime==`number`&&Math.abs(t.currentTime-r.currentTime)>.5&&(t.currentTime=r.currentTime),d===`GM`&&o&&(o.textContent=`â–¶ï¸ Retomar Todos`);return}if(n===`sync-play`){console.log(`â–¶ï¸ Retomando via sync`),typeof r.currentTime==`number`&&Math.abs(t.currentTime-r.currentTime)>.5&&(t.currentTime=r.currentTime);try{await t.play()}catch(e){console.warn(`âš ï¸ Falha ao retomar via sync:`,e),i.style.display=`flex`}d===`GM`&&o&&(o.textContent=`â¸ï¸ Pausar Todos`);return}if(n===`sync-seek`){console.log(`ðŸ”„ Sincronizando tempo:`,r.currentTime),typeof r.currentTime==`number`&&(t.currentTime=r.currentTime);return}if(n===`stop`){console.log(`â¹ï¸ Parando e fechando modal`),t.pause(),t.src=``,i.style.display=`none`;try{await e.modal.close(u)}catch(e){console.error(`Erro ao fechar modal:`,e)}}},p=e=>{r.textContent=e,r.style.display=`block`,setTimeout(()=>{r.style.display=`none`},3e3)};n.addEventListener(`click`,()=>{t.muted=!1,n.style.display=`none`,p(`ðŸ”Š Som ativado`)}),i.addEventListener(`click`,async()=>{console.log(`ðŸ‘† InteraÃ§Ã£o do usuÃ¡rio detectada`),i.style.display=`none`,t.muted=!1;try{await t.play(),n.style.display=`none`}catch(e){console.error(`âŒ Falha ao recuperar play:`,e),t.muted=!0,await t.play(),n.style.display=`block`}});var m=``,h=async(e,r)=>{if(console.log(`[DEBUG] playVideo chamada`,{videoUrl:e,videoName:r,currentVideoUrl:m,videoPaused:t.paused,videoSrc:t.src}),m===e&&!t.paused){console.log(`[DEBUG] Ignorando play duplicado`);return}m=e,t.src=e,t.muted=!0,console.log(`[DEBUG] Antes do play: video.src`,t.src,`video.muted`,t.muted);try{console.log(`[DEBUG] Chamando video.play()...`);let e=await t.play();console.log(`[DEBUG] video.play() resolvido:`,e),p(`ðŸŽ¬ ${r||`VÃ­deo`}`),setTimeout(()=>{t.paused?(console.warn(`[DEBUG] VÃ­deo pausou (possÃ­vel bloqueio de autoplay)`),n.style.display=`block`,p(`ðŸ”Š Clique para liberar o som`)):console.log(`[DEBUG] VÃ­deo estÃ¡ tocando normalmente apÃ³s play`)},300)}catch(e){console.error(`[DEBUG] Erro ao tocar vÃ­deo no modal:`,e),e.name===`AbortError`||e.name===`NotAllowedError`?(console.warn(`[DEBUG] Play bloqueado ou interrompido`),n.style.display=`block`,p(`ðŸ”Š Clique para liberar o som`),setLocked(!0)):p(`âš ï¸ Erro ao reproduzir`)}};e.onReady(async()=>{if(console.log(`player entrou!`),console.log(`[DEBUG] OBR.onReady chamado`),console.log(`Modal de vÃ­deo pronto!`),d=await e.player.getRole(),d===`GM`)a.style.display=`flex`,console.log(`ðŸ‘‘ Modo GM ativado: controles visÃ­veis`);else if(console.log(`[DEBUG] Modo PLAYER`),window.__videoSyncFirstLoad!==!0){window.__videoSyncFirstLoad=!0,window.__videoHasPlayed=!1,t.addEventListener(`playing`,()=>{window.__videoHasPlayed=!0,console.log(`[DEBUG] Evento playing: vÃ­deo tocou, nÃ£o solicitarÃ¡ mais sync`)}),t.addEventListener(`timeupdate`,()=>{t.currentTime>0&&!window.__videoHasPlayed&&(window.__videoHasPlayed=!0,console.log(`[DEBUG] Evento timeupdate: vÃ­deo tocou, nÃ£o solicitarÃ¡ mais sync`))});let n=0,r=async()=>{if(window.__videoHasPlayed){console.log(`[DEBUG] VÃ­deo jÃ¡ tocou, parando tentativas de sync`);return}n>=8||(n++,console.log(`[DEBUG] Solicitando estado do GM para sincronizar (tentativa`,n,`)`),await e.broadcast.sendMessage(l,{action:`state-request`}),setTimeout(r,1e3))};r()}o&&o.addEventListener(`click`,async()=>{let n=t.paused?`sync-play`:`sync-pause`,r=t.currentTime;console.log(`ðŸ‘‘ GM enviando ${n} em ${r}s`),await f(n,{currentTime:r,videoUrl:t.src}),await e.broadcast.sendMessage(l,{action:n,currentTime:r,videoUrl:t.src})}),c&&c.addEventListener(`click`,async()=>{console.log(`ðŸ‘‘ GM encerrando vÃ­deo para todos`),await f(`stop`),await e.broadcast.sendMessage(l,{action:`stop`})}),s&&s.addEventListener(`click`,async()=>{console.log(`ðŸ‘‘ GM forÃ§ando sincronia`),await f(`sync-seek`,{currentTime:t.currentTime}),await e.broadcast.sendMessage(l,{action:`sync-seek`,currentTime:t.currentTime})});let n=new URLSearchParams(window.location.search).get(`video`);n&&(console.log(`[DEBUG] Autoplay via URL detectado:`,n),setTimeout(()=>{console.log(`[DEBUG] Executando playVideo via autoplay URL`),h(n,`VÃ­deo`)},500)),e.broadcast.onMessage(l,async n=>{console.log(`[DEBUG] Broadcast recebido:`,n);let{action:r,videoUrl:i,videoName:a}=n.data;r===`play`&&i&&(console.log(`[DEBUG] Recebido comando play via broadcast`),h(i,a)),r===`state-request`&&d===`GM`&&(console.log(`[DEBUG] GM recebeu state-request, enviando state-response`),await e.broadcast.sendMessage(l,{action:`state-response`,videoUrl:m,currentTime:t.currentTime,isPlaying:!t.paused&&!!t.src,isPaused:t.paused&&!!t.src})),r===`state-response`&&d!==`GM`&&(console.log(`[DEBUG] Player recebeu state-response, sincronizando`),n.data&&n.data.videoUrl&&(h(n.data.videoUrl,n.data.videoName||`VÃ­deo`),typeof n.data.currentTime==`number`&&setTimeout(()=>{t.currentTime=n.data.currentTime},300))),(r===`sync-pause`||r===`sync-play`||r===`sync-seek`||r===`stop`)&&(console.log(`[DEBUG] Recebido comando de sync/stop via broadcast:`,r),await f(r,n.data))})});